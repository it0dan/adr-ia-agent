# ADR-013: API REST vs gRPC para Comunicação entre Microsserviços Internos

Data: 2025-03-22  
Status: Aceita  
Projeto: Sistema de Agendamento Distribuído  
Cliente: Cliente DEF (saúde digital)  
Autores: Time de Arquitetura Sensedia

## Contexto

O sistema de agendamento distribuído possui múltiplos microsserviços que interagem frequentemente em operações síncronas: `Agenda`, `Paciente`, `Notificação`, `Médico`.

A decisão gira em torno de qual protocolo usar para essas comunicações internas:

- REST com JSON sobre HTTP
- gRPC com Protobuf sobre HTTP/2

## Decisão

Adotamos **gRPC** para as comunicações internas entre microsserviços. APIs externas continuarão sendo expostas via REST.

## Alternativas consideradas

- **REST com JSON:**
  - + Amplamente adotado
  - + Fácil de debugar
  - – Verboso e menos eficiente em payload
  - – Ausência de contrato fortemente tipado (salvo OpenAPI)

- **gRPC:**
  - + Alto desempenho e suporte nativo a streaming
  - + Forte tipagem com Protobuf
  - + Geradores de código para múltiplas linguagens
  - – Curva de aprendizado
  - – Debugging exige ferramentas (ex: BloomRPC)

## Justificativa

- Volume alto de chamadas internas e necessidade de baixa latência
- Equipe já adota Protobuf em integrações externas
- Facilita consistência de contratos e integração com gateways modernos (ex: Envoy)

## Consequências

- APIs internas mais performáticas e tipadas
- Maior complexidade inicial de setup (tooling)
- Integração facilitada com observabilidade e tracing (ex: OpenTelemetry com gRPC interceptors)

## Embasamento técnico

- [gRPC vs REST – Comparativo oficial](https://grpc.io/docs/what-is-grpc/)
- [Google Cloud: When to use gRPC](https://cloud.google.com/blog/products/api-management/grpc-vs-rest)
- Livro: “Designing Microservices Platforms with NGINX” – Capítulo 6
- Talk: “The Future of APIs is gRPC” – QCon SF 2023

## ADRs relacionadas

- ADR-006: Estratégia de observabilidade em APIs internas
- ADR-002: Gerador de clientes a partir de contratos
- ADR-010: Comunicação síncrona e retries em ambientes distribuídos

## Revisões futuras

Reavaliar caso surjam novos requisitos de auditoria detalhada ou integração com clientes externos via REST.