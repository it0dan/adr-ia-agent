# ADR-012: Estratégia de Comunicação por Eventos — Event Notification vs Event-Carried State Transfer

Data: 2025-04-12  
Status: Aceita  
Projeto: Plataforma de Faturamento Modular  
Cliente: Cliente ABC (segmento SaaS)  
Autores: Arquitetura Sensedia

## Contexto

A arquitetura proposta para a nova plataforma de faturamento adota um estilo baseado em microsserviços. Os domínios de “Fatura”, “Pagamento” e “Notificações” precisam se comunicar de forma assíncrona.

Dois padrões de comunicação baseados em eventos foram considerados:

1. **Event Notification**: eventos apenas informam que algo aconteceu (ex: `FaturaGerada`)
2. **Event-Carried State Transfer (ECST)**: eventos carregam o estado completo da entidade no momento da emissão (ex: `FaturaGerada` + dados da fatura)

## Decisão

Adotamos o padrão **Event-Carried State Transfer (ECST)** para a maioria dos eventos de domínio, com exceção de eventos de sinalização para rastreamento (ex: logs de auditoria).

## Alternativas consideradas

- **Event Notification puro:**
  - + Mensagens leves
  - – Necessita de chamadas de recuperação de estado (chaining/sincronização)
  - – Aumenta o acoplamento entre produtores e consumidores

- **ECST:**
  - + Reduz dependência entre serviços
  - + Evita consultas adicionais para reconstrução de estado
  - – Mensagens maiores
  - – Riscos de inconsistência se não houver versionamento ou schema registry

## Justificativa

- A maioria dos serviços consumidores não possui acesso direto à base de dados do produtor.
- ECST reduz a complexidade dos consumidores.
- A equipe já possui conhecimento prévio em Avro e Schema Registry (evitando problemas com versionamento).

## Consequências

- Ganho em autonomia dos microsserviços
- Maior carga na malha de eventos (Kafka)
- Necessidade de controle de versionamento explícito nos eventos

## Embasamento técnico

- [Enterprise Integration Patterns – Event-Carried State Transfer](https://www.enterpriseintegrationpatterns.com/patterns/messaging/EventCarriedStateTransfer.html)
- ThoughtWorks Radar – Event-Driven Architecture [link]
- “Designing Event-Driven Systems”, Ben Stopford – Capítulo 4

## ADRs relacionadas

- ADR-003: Estratégia de versionamento de payloads em eventos
- ADR-009: Uso de Kafka com Avro + Schema Registry
- ADR-005: Assincronismo em integrações entre domínios

## Revisões futuras

Revisar em caso de aumento crítico no volume de eventos ou mudança de plataforma (ex: Kafka para NATS).